## 1. 简介

1.1 目的范围

通过使用ACE framework构建FTP Server，熟悉项目研发过程中涉及的设计、开发、自测、维护等的流程与规范。

## 2. 总体设计

2.1 系统上下文

    FTP Server部署运行在x86 linux环境中（如ubuntu），FTP Client无约束环境（遵循FTP协议规范即可）

2.2 运行环境

运行在x86体系ubuntu 22.04中

2.3 设计思路

    FTP需要2个通道：控制通道和数据通道。2个通道通过消息队列传递消息。
    Acceptor在收到客户端连接请求，创建相应的Server_PI对象。Server_PI负责消息的处理和通过Server_DTP的对象完成数据连接的建立和数据的传输。
    采用迭代器模式来通过用户输入的command来遍历需要的对象方法。

## 3. 系统功能设计

3.1 功能分配

    Server_PI模块，主要实现来自Client的命令解析，以及命令连接信息接受与响应。
    Server_DTP模块，主要实现数据连接的建立，文件的上传和下载及目录信息的发送。

3.2 运行设计

3.3 接口设计

    user, 校验用户名
    pass, 校验用户名以及密码
    pwd，返回当前目录
    cwd，切换目录
    pasv，服务端开启监听，并告知客户端
    list，获取当前目录下文件及子目录列表
    type，切换binary以及ascii模式
    size，获取给定文件的大小
    mkd，创建目录
    rmd，删除目录
    dele，删除文件
    stor，上传文件
    retr，下载文件
    quit，退出

## 4. 故障模式分析

4.1 登录异常

    用户名不存在，响应FTP错误码530
    密码不匹配，响应FTP错误码530

4.2 操作文件不存在

    SIZE文件不存在，响应FTP错误码550
    RETR文件不存在，响应FTP错误名550
    DELE文件不存在，响应FTP错误码550

4.3 操作目录不存在

    CWD目录不存在，响应FTP错误码550
    RMD目录不存在，响应FTP错误码550

4.4 操作目录已存在

    MKD目录已存在，响应FTP错误码550

4.5 用户未登陆

    在未登录的情况下接收到其他命令，响应FTP错误码530

4.6 数据通道未建立

    在接收到LIST、RETR、STOR命令时，数据通道未建立，响应FTP错误码425

4.7 未知或未实现命令

    接收到未知或未实现命令时，响应FTP错误码500


## 5. 错误处理

    如果recv异常（-1），则认为连接有问题；则需要断开连接。


## 6. 可测试性设计

    核心接口使用gtest构建单元测试案例
